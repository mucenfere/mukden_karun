<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Historical Map of Qing Manchu</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>
<div id="map"></div>

<script>
  const map = L.map('map').setView([41.8, 123.4], 7);

  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; OpenStreetMap contributors'
});

  const satellite = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  {
    maxZoom: 19,
    attribution: '&copy; Esri'
  }
);
  const labels = L.tileLayer(
  'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',
  { maxZoom: 19, attribution: '&copy; Esri' }
);

  satellite.addTo(map);
  labels.addTo(map); 

  async function loadGeoJSON(url, options = {}) {
    const res = await fetch(url);
    const gj = await res.json();
    return L.geoJSON(gj, {
      style: options.style,
      pointToLayer: options.pointToLayer,
      onEachFeature: (feature, layer) => {
        const p = feature.properties || {};
        const title = p.name || p.name_ko || p.name_zh || '정보';
        layer.bindPopup(`<b>${title}</b>`);
      }
    });
  }

  (async () => {
    const admin = await loadGeoJSON('./data/admin.geojson', { style: { weight: 2, fillOpacity: 0.1 }});
    const roads = await loadGeoJSON('./data/roads.geojson', { style: { weight: 3 }});
    const cities = await loadGeoJSON('./data/cities.geojson', {
      pointToLayer: (f, latlng) => L.circleMarker(latlng, { radius: 5, weight: 2, fillOpacity: 0.7 })
    });

    admin.addTo(map);
    cities.addTo(map);
    roads.addTo(map);

    const baseLayers = { "위성": satellite, "OSM": osm };
    const overlays = { "행정/경계": admin, "교통로": roads, "도시": cities };

    L.control.layers(baseLayers, overlays, { collapsed: false }).addTo(map);
  })();
</script>
</body>
</html>
